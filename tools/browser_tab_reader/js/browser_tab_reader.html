<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app_title">Firefox Tab Reader</title>
    <!-- JSZip loading with fallback -->
    <script>
    (function() {
        function loadJSZip() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
                script.integrity = 'sha512-XMVd28F1oH/O71fzw+nVY1Q4SaYcr3Qa6WUItvL4g07WH5I0mo6YFY0Q9XaZ2O0RlQppXZxyW3z3a2X2v5YHQ==';
                script.crossOrigin = 'anonymous';
                script.onload = () => {
                    if (window.JSZip) {
                        resolve();
                    } else {
                        loadLocalFallback();
                    }
                };
                script.onerror = loadLocalFallback;
                document.head.appendChild(script);

                function loadLocalFallback() {
                    const fallbackScript = document.createElement('script');
                    fallbackScript.src = 'js/jszip.min.js';
                    fallbackScript.onload = resolve;
                    fallbackScript.onerror = () => {
                        console.error('JSZip failed to load');
                        document.getElementById('status').textContent = 'Error: Required libraries failed to load';
                        reject();
                    };
                    document.head.appendChild(fallbackScript);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadJSZip().catch(() => {
                // Handle complete loading failure
                document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            });
        });
    })();
    </script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1 data-i18n="app_title">Firefox Tab Reader</h1>
        <h2 data-i18n="app_subtitle">Browser Tab Dictionary Tool</h2>
        
        <div class="instructions">
            <h3 data-i18n="instructions_title">Instructions</h3>
            
            <div class="guide-english">
                <p data-i18n="instructions_content">This tool extracts all your open Firefox tabs and identifies dictionary websites...</p>
                <ol>
                    <li data-i18n="instructions_step1">Click the "Read Tabs" button below to extract all your currently open tabs.</li>
                    <li data-i18n="instructions_step2">The tool will identify dictionary websites and display them in a table.</li>
                    <li data-i18n="instructions_step3">You can save the results as a JSON file for use with gist-dictionary.</li>
                </ol>
                <p><strong data-i18n="note">Note:</strong> <span data-i18n="firefox_note">This tool only works when opened in Firefox...</span></p>
            </div>
        </div>
        
        <div class="buttons">
            <button id="readTabsBtn" data-i18n="read_tabs_btn">Read Tabs</button>
            <button id="saveJsonBtn" disabled data-i18n="save_json_btn">Save as JSON</button>
            <button id="copyJsonBtn" disabled data-i18n="copy_json_btn">Copy JSON</button>
        </div>
        
        <div id="status" class="hidden"></div>
        
        <div class="dictionary-tabs hidden" id="resultsContainer">
            <h3 data-i18n="dictionary_tabs_title">Dictionary Tabs</h3>
            <p><span data-i18n="found_tabs">Found</span> <span id="dictTabCount">0</span> <span data-i18n="dictionary_tabs">dictionary tabs</span> <span data-i18n="out_of">out of</span> <span id="totalTabCount">0</span> <span data-i18n="total_tabs">total tabs</span>.</p>
            
            <input type="text" id="searchInput" data-i18n-placeholder="search_placeholder" placeholder="Search tabs...">
            
            <table id="tabsTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th data-i18n="title_header">Title</th>
                        <th data-i18n="url_header">URL</th>
                        <th data-i18n="dictionary_header">Dictionary</th>
                        <th data-i18n="search_term_header">Search Term</th>
                    </tr>
                </thead>
                <tbody id="tabsTableBody">
                    <!-- Table rows will be added here dynamically -->
                </tbody>
            </table>
        </div>
        
        <div id="jsonOutput" class="hidden">
            <h3 data-i18n="json_output_title">JSON Output</h3>
            <pre id="jsonContent"></pre>
        </div>
        
        <div id="permissionsGuide" class="hidden instructions">
            <h3>How to Enable Tabs Permission in Firefox / 如何在Firefox中启用标签页权限</h3>
            
            <div class="guide-english">
                <h4 data-i18n="english_instructions">English Instructions:</h4>
                <div class="quick-setup">
                    <button id="createExtensionBtn" class="extension-btn" data-i18n="create_extension_btn">Create Extension Files</button>
                    <span id="extensionStatus" class="hidden"></span>
                </div>
                <p data-i18n="extension_instructions">You can either use the button above to automatically create the extension files, or follow these manual steps:</p>
                <ol>
                    <li data-i18n="create_extension_step">Create a Firefox Extension:
                        <ol>
                            <li data-i18n="create_folder_step">Create a new folder on your computer for the extension</li>
                            <li data-i18n="create_manifest_step">Inside this folder, create a file named <code>manifest.json</code> with the following content:
                                <pre>
{
  "manifest_version": 2,
  "name": "Tab Reader",
  "version": "1.0",
  "description": "Reads browser tabs",
  "permissions": ["tabs"],
  "browser_action": {
    "default_title": "Tab Reader"
  }
}
                                </pre>
                            </li>
                        </ol>
                    </li>
                    <li data-i18n="load_extension_step">Load the Extension in Firefox:
                        <ol>
                            <li data-i18n="open_debugging_step">Open Firefox and type <code>about:debugging</code> in the address bar</li>
                            <li data-i18n="select_firefox_step">Click on "This Firefox" in the left sidebar</li>
                            <li data-i18n="load_addon_step">Click "Load Temporary Add-on..."</li>
                            <li data-i18n="select_manifest_step">Navigate to your extension folder and select the <code>manifest.json</code> file</li>
                        </ol>
                    </li>
                    <li data-i18n="use_tool_step">Use This Tool:
                        <ol>
                            <li data-i18n="refresh_page_step">After installing the extension, refresh this page</li>
                            <li data-i18n="click_button_step">Click the "Read Tabs" button again</li>
                            <li data-i18n="access_tabs_step">The tool should now be able to access your tabs</li>
                        </ol>
                    </li>
                </ol>
                <p><strong data-i18n="note">Note:</strong> <span data-i18n="temp_extension_note">This temporary extension will be removed when you close Firefox.</span></p>
            </div>
            
            <div class="guide-chinese">
                <h4 data-i18n="chinese_instructions">中文说明：</h4>
                <div class="quick-setup">
                    <button id="createExtensionBtnZh" class="extension-btn" data-i18n="create_extension_btn_zh">创建扩展文件</button>
                    <span id="extensionStatusZh" class="hidden"></span>
                </div>
                <p data-i18n="extension_instructions_zh">您可以使用上面的按钮自动创建扩展文件，或按照以下手动步骤操作：</p>
                <ol>
                    <li data-i18n="create_extension_step_zh">创建Firefox扩展：
                        <ol>
                            <li data-i18n="create_folder_step_zh">在您的计算机上为扩展创建一个新文件夹</li>
                            <li data-i18n="create_manifest_step_zh">在此文件夹中，创建一个名为<code>manifest.json</code>的文件，内容如下：
                                <pre>
{
  "manifest_version": 2,
  "name": "Tab Reader",
  "version": "1.0",
  "description": "Reads browser tabs",
  "permissions": ["tabs"],
  "browser_action": {
    "default_title": "Tab Reader"
  }
}
                                </pre>
                            </li>
                        </ol>
                    </li>
                    <li data-i18n="load_extension_step_zh">在Firefox中加载扩展：
                        <ol>
                            <li data-i18n="open_debugging_step_zh">打开Firefox并在地址栏中输入<code>about:debugging</code></li>
                            <li data-i18n="select_firefox_step_zh">点击左侧边栏中的"此Firefox"</li>
                            <li data-i18n="load_addon_step_zh">点击"临时载入附加组件..."</li>
                            <li data-i18n="select_manifest_step_zh">导航到您的扩展文件夹并选择<code>manifest.json</code>文件</li>
                        </ol>
                    </li>
                    <li data-i18n="use_tool_step_zh">使用此工具：
                        <ol>
                            <li data-i18n="refresh_page_step_zh">安装扩展后，刷新此页面</li>
                            <li data-i18n="click_button_step_zh">再次点击"读取标签页"按钮</li>
                            <li data-i18n="access_tabs_step_zh">该工具现在应该能够访问您的标签页</li>
                        </ol>
                    </li>
                </ol>
                <p><strong data-i18n="note_zh">注意：</strong> <span data-i18n="temp_extension_note_zh">当您关闭Firefox时，此临时扩展将被移除。</span></p>
            </div>
        </div>
    </div>

    

        

        
        
        

        
        
        

        

        

        

        

        

        

        

        

        

        

        
                
                
                
                        
                        
                    <!-- JavaScript will be loaded from external files -->
    <script src="js/i18n.js"></script>
    <script src="js/main.js"></script>
    <script src="js/tab_reader.js"></script>
    <script>
        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            initLanguageSwitcher();
            applyLanguage();
        });
    </script>
</body>
</html>